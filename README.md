# 母语化编程 VSCode 扩展 —— 使用说明

## 一、快速开始

1. 安装扩展后，打开任意代码文件，扩展自动激活。
2. 右键代码区或使用命令面板（Ctrl+Shift+P）调用相关命令。
3. 默认开启"装饰显示"模式，代码中的英文标识符会被母语翻译覆盖显示。
4. 如需关闭/开启装饰，或切换翻译方式，请参考下文详细说明。

---

## 二、右键菜单/命令面板功能命令及用法（详细步骤说明）

下列所有命令均可通过命令面板（Ctrl+Shift+P）输入命令名，或在代码区右键菜单中找到对应项。

### 1. 提取文件中的词汇（codeLocalizer.extractCurrentFile）
- **入口**：右键代码区，选择"提取文件中的词汇"，或命令面板输入命令。
- **操作步骤**：
  1. 右键点击代码区，选择"提取文件中的词汇"。
  2. 弹出提取页，显示当前文件所有可翻译的标识符。
  3. 可继续进行翻译、编辑、批量操作等。
- **适用场景**：需要批量提取并翻译当前文件的所有标识符时。

### 2. 翻译选中的标识符（codeLocalizer.translateSelected）
- **入口**：选中代码后，右键菜单或命令面板输入"翻译选中的标识符"。
- **操作步骤**：
  1. 在代码中选中一个或多个标识符。
  2. 右键选择"翻译选中的标识符"，或命令面板输入命令。
  3. 弹出翻译结果预览，审核后可合并到词汇表。
- **适用场景**：只需翻译部分标识符时。

### 3. 查看翻译结果（codeLocalizer.showTranslationPreview）
- **入口**：命令面板输入"查看翻译结果"。
- **操作步骤**：
  1. 命令面板输入"查看翻译结果"。
  2. 弹出词汇表预览页面，可查看、编辑、导出翻译内容。
- **适用场景**：需要查看或管理当前项目所有翻译内容时。

### 4. 清除词汇表（codeLocalizer.clearVocabulary）
- **入口**：命令面板输入"清除词汇表"。
- **操作步骤**：
  1. 命令面板输入"清除词汇表"。
  2. 确认后清空所有翻译记录。
- **适用场景**：需要重置项目翻译内容时。

### 5. 设置目标语言（codeLocalizer.setTargetLanguage）
- **入口**：命令面板输入"设置目标语言"。
- **操作步骤**：
  1. 命令面板输入"设置目标语言"。
  2. 选择或输入目标语言代码（如 zh-CN、en-US）。
- **适用场景**：需要切换翻译目标语言时。

### 6. 显示当前目标语言（codeLocalizer.showTargetLanguage）
- **入口**：命令面板输入"显示当前目标语言"。
- **操作步骤**：
  1. 命令面板输入"显示当前目标语言"。
  2. 弹窗显示当前设置的目标语言。
- **适用场景**：随时查看当前翻译目标语言。

### 7. 配置本地LLM设置（codeLocalizer.configLocalLLM）
- **入口**：命令面板输入"配置本地LLM设置"。
- **操作步骤**：
  1. 命令面板输入"配置本地LLM设置"。
  2. 按提示填写 Ollama API 地址和模型名称。
- **适用场景**：首次使用或需更换本地大模型时。

### 8. 清除所有装饰（codeLocalizer.clearDecorationCache）
- **入口**：命令面板输入"清除所有装饰"。
- **操作步骤**：
  1. 命令面板输入"清除所有装饰"。
  2. 所有母语装饰立即消失。
- **适用场景**：需要临时关闭所有装饰显示时。

### 9. 管理技术术语黑名单（codeLocalizer.manageBlacklist）
- **入口**：命令面板输入"管理技术术语黑名单"。
- **操作步骤**：
  1. 命令面板输入"管理技术术语黑名单"。
  2. 弹出黑名单管理界面，可增删技术术语。
- **适用场景**：需要过滤不应翻译的术语时。

### 10. 添加当前选中的标识符到黑名单（codeLocalizer.addToBlacklist）
- **入口**：选中标识符后，命令面板输入"添加当前选中的标识符到黑名单"。
- **操作步骤**：
  1. 选中代码中的标识符。
  2. 命令面板输入"添加当前选中的标识符到黑名单"。
- **适用场景**：快速将特殊标识符加入黑名单。

### 11. 编辑黑名单文件（codeLocalizer.editBlacklistInSettings）
- **入口**：命令面板输入"编辑黑名单文件"。
- **操作步骤**：
  1. 命令面板输入"编辑黑名单文件"。
  2. 直接编辑 `blacklist.json` 文件。
- **适用场景**：需要批量编辑黑名单内容时。

### 12. 整理词汇表（codeLocalizer.organizeVocabulary）
- **入口**：命令面板输入"整理词汇表"。
- **操作步骤**：
  1. 命令面板输入"整理词汇表"。
  2. 自动去重、排序、优化词汇表内容。
- **适用场景**：词汇表内容较多时，需自动整理。

---

## 三、装饰显示功能

- **入口**：
  - 默认开启，或通过命令面板输入【切换代码母语显示】（codeLocalizer.toggleMotherTongueDisplay）。
  - 也可在设置中修改 `codeLocalizer.enableMotherTongueDisplay`。
- **详细操作步骤**：
  1. 安装扩展后，打开任意代码文件，母语装饰自动生效。
  2. 如需关闭/开启装饰，可：
     - 命令面板输入"切换代码母语显示"，或
     - 设置中将 `enableMotherTongueDisplay` 设为 false/true。
  3. 切换tab、窗口、页面、滚动时，装饰自动恢复。
- **适用场景**：日常阅读、理解、维护代码时，提升可读性。
- **注意事项**：仅界面显示，不修改源码，关闭后无残留。

---

## 四、词汇表管理

- **入口**：
  - 命令面板输入【查看翻译结果】（codeLocalizer.showTranslationPreview）。
  - 右键菜单/命令面板选择【清除词汇表】（codeLocalizer.clearVocabulary）。
  - 右键菜单/命令面板选择【整理词汇表】（codeLocalizer.organizeVocabulary）。
- **详细操作步骤**：
  1. 查看词汇表：命令面板输入"查看翻译结果"，弹出词汇表预览页面。
  2. 清空词汇表：命令面板输入"清除词汇表"，确认后清空所有翻译记录。
  3. 整理词汇表：命令面板输入"整理词汇表"，自动去重、排序、优化词汇表内容。
- **适用场景**：团队协作、统一术语、批量管理翻译。
- **注意事项**：词汇表为项目级，建议定期备份。

---

## 五、黑名单管理

- **入口**：
  - 命令面板输入【管理技术术语黑名单】（codeLocalizer.manageBlacklist）。
  - 命令面板输入【添加当前选中的标识符到黑名单】（codeLocalizer.addToBlacklist）。
  - 命令面板输入【编辑黑名单文件】（codeLocalizer.editBlacklistInSettings）。
- **详细操作步骤**：
  1. 管理黑名单：命令面板输入"管理技术术语黑名单"，弹出黑名单管理界面。
  2. 添加到黑名单：选中标识符后，命令面板输入"添加当前选中的标识符到黑名单"。
  3. 编辑黑名单文件：命令面板输入"编辑黑名单文件"，直接编辑 `blacklist.json`。
- **适用场景**：过滤不需要翻译的技术术语、短词、特殊标识符。
- **注意事项**：黑名单为项目级，修改后需刷新装饰生效。

---

## 六、设置项说明

- **入口**：VSCode 设置（settings.json 或设置界面），搜索 `codeLocalizer`。
- **常用设置项**（与 package.json 保持一致）：
  - `codeLocalizer.enableMotherTongueDisplay`：是否启用母语装饰显示（true/false）。
  - `codeLocalizer.targetLanguage`：目标翻译语言（如 zh-CN、en-US）。
  - `codeLocalizer.translationService.ollamaApiUrl`：本地LLM API地址。
  - `codeLocalizer.translationService.ollamaModelName`：本地LLM模型名称。
  - `codeLocalizer.motherTongueDisplayStyle`：母语显示样式（overlay/hover/inlineHint）。
- **详细操作步骤**：
  1. 打开VSCode设置，搜索"codeLocalizer"。
  2. 根据需要修改相关设置项，保存后自动生效。
- **适用场景**：自定义扩展行为、适配不同开发需求。
- **注意事项**：部分设置修改后需重启VSCode或刷新装饰。

---

## 七、提取页的两种翻译方式（详细步骤说明）

### 1. 本地LLM自动翻译
- **入口**：右键代码区，选择【提取文件中的词汇】（对应命令：codeLocalizer.extractCurrentFile），进入提取页。
- **详细操作步骤**：
  1. 在编辑器中右键点击代码区，选择"提取文件中的词汇"。
  2. 弹出"已提取的标识符"页面，页面会列出当前文件中所有可翻译的标识符。
  3. 可在列表中编辑、删除、批量选择标识符。
  4. 点击页面下方的【本地llm翻译】按钮，扩展会自动调用本地大模型（如Ollama）对所有标识符进行批量翻译。
  5. 翻译完成后，自动弹出"翻译结果预览"页面，用户可审核、编辑翻译结果。
  6. 审核无误后，点击"合并到词汇表"，将翻译结果保存到项目词汇表中。
- **适用场景**：本地已配置好大模型，追求自动化、批量翻译。
- **注意事项**：需提前在设置中配置好 Ollama API 地址和模型名称（如 codeLocalizer.translationService.ollamaApiUrl、codeLocalizer.translationService.ollamaModelName）。

---

### 2. AI助手/人工翻译（粘贴JSON）
- **入口**：右键代码区，选择【提取文件中的词汇】，进入提取页。
- **详细操作步骤**：
  1. 在编辑器中右键点击代码区，选择"提取文件中的词汇"。
  2. 弹出"已提取的标识符"页面，页面会列出当前文件中所有可翻译的标识符。
  3. 可在列表中编辑、删除、批量选择标识符。
  4. 点击页面下方的【复制到AI助手翻译】按钮，所有标识符和详细翻译提示会自动复制到剪贴板。
  5. 将内容粘贴到外部AI助手（如ChatGPT、Copilot、Claude等），获得翻译结果。
  6. 复制AI助手返回的JSON数组（格式如：[{"original":"StdId","translated":"标准ID","type":"identifier","source":"ai"}, ...]）。
  7. 回到提取页，点击【AI助手翻译提交】按钮，弹出粘贴框，将JSON数组粘贴进去并提交。
  8. 翻译结果会自动弹出"翻译结果预览"页面，用户可审核、编辑翻译结果。
  9. 审核无误后，点击"合并到词汇表"，将翻译结果保存到项目词汇表中。
- **适用场景**：本地无大模型，或希望用外部AI/人工获得更高质量、更灵活的翻译。
- **注意事项**：
  - 粘贴内容必须是严格的JSON数组格式，不能有多余说明或代码块标记。
  - 支持多轮粘贴、批量导入，自动去重。

---

### 对比总结
- **本地LLM翻译**：一键自动，适合有本地模型环境的用户，效率高。
- **AI助手翻译**：适合用外部AI/人工获得更优翻译，灵活性高，适合团队协作或特殊术语场景。

---

## 八、常见问题

- **装饰不显示/丢失？**  
  请确保已开启装饰功能，且词汇表中有对应翻译。切换tab/窗口/页面时装饰会自动恢复。
- **缓存会不会污染其它项目？**  
  不会，缓存只在当前会话内有效，且按文档URI区分。
- **如何清空所有装饰？**  
  关闭装饰功能或用命令清空即可。
- **如何贡献/编辑翻译？**  
  在翻译预览界面可直接编辑并提交贡献。
- **如何切换/添加新语言？**  
  通过"设置目标语言"命令，或在设置中修改 targetLanguage。
- **如何配置本地大模型？**  
  通过"配置本地 LLM"命令，填写API地址和模型名称。

---

如需开发/设计细节，请参考项目内的 `说明.md` 文件。
如需进一步定制或有新需求，欢迎随时联系开发者！
